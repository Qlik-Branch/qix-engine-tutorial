<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>
    Stay in Sync with the Engine
  </title>
  <link href="bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="p4.css" rel="stylesheet"><link href="app.css" rel="stylesheet"></head>

<body>
  <script src="jquery.min.js"></script>
  <script src="bootstrap/dist/js/bootstrap.min.js"></script>

  <!-- <div id="sidebar" class="sidebar">
  <div class="sidebar-label">QIX Tutorial</div>
  <div><a href="javascript:void(0)" class="closebtn">&times;</a></div>
  <hr/>
  <ul class="nav nav-sidebar">
    <li class="chapter-1"><a href="101. What is QIX and Why Should You Care.html"><span class="glyphicon glyphicon-menu-right"></span> 101. What is QIX and why should you care</a>
      <ul class="nav sub-sidebar sublist-0">
        <li><a href="#h2-0">The QIX engine</a></li>
        <li><a href="#h2-1">The associative model: overview</a></li>
        <li><a href="#h2-2">The associative model: breakdown</a></li>
        <li><a href="#h2-3">Leveraging the associative model</a></li>
        <li><a href="#h2-4">Fin</a></li>
      </ul>
    </li>
    <li class="chapter-2"><a href="102. Meet the Engine.html"><span class="glyphicon glyphicon-menu-right"></span> 102. Meet the engine</a>
      <ul class="nav sub-sidebar sublist-1">
        <li><a href="#h2-0">Structure of the associative model</a></li>
        <li><a href="#h2-1">Classes and their methods</a></li>
        <li><a href="#h2-2">Working with generic objects</a></li>
        <li><a href="#h2-3">Fin</a></li>
      </ul>
    </li>
    <li class="chapter-3"><a href="103. Talk to the Engine.html"><span class="glyphicon glyphicon-menu-right"></span> 103. Talk to the Engine</a>
      <ul class="nav sub-sidebar sublist-2">
        <li><a href="#h2-0">Establishing a session with the engine</a></li>
        <li><a href="#h2-1">Speaking the engine's language with handles</a></li>
        <li><a href="#h2-2">Fin</a></li>
      </ul>
    </li>
    <li class="chapter-4"><a href="104. Stay in Sync with the Engine.html"><span class="glyphicon glyphicon-menu-right"></span> 104. Stay in Sync with the Engine</a>
      <ul class="nav sub-sidebar sublist-2">
        <li><a href="#h2-0">Invalidation and the generic object lifecycle</a></li>
        <li><a href="#h2-1">Listening to the engine for invalidation events</a></li>
        <li><a href="#h2-2">Fin</a></li>
      </ul>
    </li>
    <li class="chapter-5"><a href="105. Streamline with Enigma.html"><span class="glyphicon glyphicon-menu-right"></span> 105. Streamline with Enigma</a>
      <ul class="nav sub-sidebar sublist-2">
        <li><a href="#h2-0">Meet enigma</a></li>
        <li><a href="#h2-1">Configuring enigma for an engine</a></li>
        <li><a href="#h2-2">Handling invalidation in enigma</a></li>
        <li><a href="#h2-3">Fin</a></li>
      </ul>
    </li>
    </li>
    <li class="chapter-6"><a href="106. Build a Dashboard - Set Up.html"><span class="glyphicon glyphicon-menu-right"></span> 106. Build a Dashboard - Set Up</a>
      <ul class="nav sub-sidebar sublist-2">
        <li><a href="#h2-0">Project goal and overview</a></li>
        <li><a href="#h2-1">Setting up the project</a></li>
        <li><a href="#h2-2">Connecting to a server</a></li>
        <li><a href="#h2-3">Opening a model</a></li>
        <li><a href="#h2-4">Fin</a></li>
      </ul>
    </li>
    <li class="chapter-7"><a href="107. Creating Filters with ListObjects.html"><span class="glyphicon glyphicon-menu-right"></span> 107. Creating Filters with ListObjects</a>
      <ul class="nav sub-sidebar sublist-2">
        <li><a href="#h2-0">Defining list objects</a></li>
        <li><a href="#h2-1">Setting up data fetching</a></li>
        <li><a href="#h2-2">Getting the list object layouts</a></li>
        <li><a href="#h2-3">Rendering a filter with the layout</a></li>
        <li><a href="#h2-4">Making selections with the filter</a></li>
      </ul>
    </li>
    <li class="chapter-8"><a href="108. Creating Charts with HyperCubes.html"><span class="glyphicon glyphicon-menu-right"></span> 108. Creating Charts with HyperCubes</a>
      <ul class="nav sub-sidebar sublist-2">
        <li><a href="#h2-0">What are hypercubes?</a></li>
        <li><a href="#h2-1">Defining a hypercube</a></li>
        <li><a href="#h2-2">Parsing a hypercube layout</a></li>
        <li><a href="#h2-3">Sorting the hypercube</a></li>
        <li><a href="#h2-4">Visualizing the hypercube</a></li>
        <li><a href="#h2-5">Fin</a></li>
      </ul>
    </li>
  </ul>
</div>

 <div class="hamburger-open">&#9776;</div>  -->

  <div class="main-content">
    <div class="container content">
      <div class="header">
        <h1>104. Stay in Sync with the Engine</h1><p>Learning goal: Understand Generic Object invalidation and how to keep data in sync between browser and server</p>
          <hr/>
      </div>
      <div id="body-content">
        <div id="section-0"class="section "><div class="row">
              <div class="col-xs-8 col-xs-offset-2 col-sm-8 col-sm-offset-2 col-md-8 col-md-offset-2 col-lg-8 col-lg-offset-2 body-left">
        <p>In Chapter 102, we looked at how Generic Objects can be used to get dynamically calculated data from the QIX Engine. We saw how we can define special properties called <em>dynamic properties</em> on our Generic Objects. These properties are interpretable by the QIX Engine. The QIX Engine can use the dynamic property definitions along with the current state of data to produce a <em>layout</em>.</br></br></p><p>The layout is not persisted in the Engine. We only receive the layout when we use the API method <code>GetLayout</code> to calculate and retrieve it for an object. The layout is delivered to us in the browser via our WebSocket connection as discussed in Chapter 103.</p></div><div class="col-xs-0 col-sm-0 col-md-0 col-lg-0 body-right"><div class="graph"></div></div></div></div><div id="section-1"class="section "><div class="row">
              <div class="col-xs-8 col-xs-offset-2 col-sm-8 col-sm-offset-2 col-md-8 col-md-offset-2 col-lg-8 col-lg-offset-2 body-left">
        <p>Recall that QIX’s Associative Model is like a state machine. We can filter the data on the fly, or even change properties of existing Generic Objects. All of these operations happen in our QIX Engine. But what if we have a layout in our browser for a Generic Object? While the QIX Engine can update itself, it will not update the data we’ve pulled into our browser. Therefore, if we filter our data model after we’ve pulled a layout for a Generic Object, our Generic Object will be out of sync with the state of data in the Engine. This out of sync behavior of a Generic Object is known as <strong>invalidation</strong>.</p><p><diagram of a QIX Engine state, with a simple generic object calculating something simple like sum of sales. show them out of sync as engine filters?></p></div><div class="col-xs-0 col-sm-0 col-md-0 col-lg-0 body-right"><div class="graph"></div></div></div></div><div id="section-2"class="section "><div class="row">
              <div class="col-xs-8 col-xs-offset-2 col-sm-8 col-sm-offset-2 col-md-8 col-md-offset-2 col-lg-8 col-lg-offset-2 body-left">
        <h2>Invalidation and the Generic Object Lifecycle</h2><p>During a session with the QIX Engine, we can create or get Generic Object instances. These instances have two possible states:</p><ul><li><p>valid – we have a layout for the latest state of the data in the QIX Engine</p></li><li><p>invalid – we do not have a layout for the latest state of data in the QIX Engine</br></br></p></li></ul><p>Essentially, the valid/invalid state just tells us whether we are in sync with the QIX Engine or not for any specific object. This is important to know when we are building dashboards for example. If a user filters our dashboard, we want our charts to stay in sync and reflect that filter. Therefore, we need to make sure the Generic Objects for our chart stay valid.</br></br></p><p>When objects go from invalid to valid, we refer to the event as <strong>validation</strong>. When objects go from valid to invalid, we refer to the event as <strong>invalidation</strong>.</br></br></p><p>Validation of Generic Objects is easy: <code>GetLayout</code> calls validate objects. They return the latest layout based on the current state of data, thus putting our browser-side data back in sync with the Engine.</p></div><div class="col-xs-0 col-sm-0 col-md-0 col-lg-0 body-right"><div class="graph"></div></div></div></div><div id="section-3"class="section interactive-validation"><div class="row">
              <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6 body-left">
        <p>Invalidation of Generic Objects can happen several ways, since it just depends on the underlying state of the data model changing somehow. The most common way is by a user filtering the data model. Another common way to invalidate a Generic Object is to modify the properties of the Generic Object. If the properties change, our layout can no longer be valid so the Generic Object will invalidate and require a new layout. <strong>Play with validation</strong> and invalidation events in the diagram to the right.</p></div><div class="col-xs-6 col-sm-6 col-md-6 col-lg-6 body-right"><div class="graph" id="interactive-validation"></div></div></div></div><div id="section-4"class="section "><div class="row">
              <div class="col-xs-8 col-xs-offset-2 col-sm-8 col-sm-offset-2 col-md-8 col-md-offset-2 col-lg-8 col-lg-offset-2 body-left">
        <h2>Listening to the Engine for Invalidation Events</h2><p>If we want to keep our Generic Objects in sync, we need to get their layouts any time that they invalidate. Fortunately for us, the QIX Engine alerts us whenever invalidations happen using a special property on a JSON-RPC message: <code>change</code>.</br></br></p><p>The <code>change</code> property is an array of handles. Whenever an event happens in the Engine that invalidates some objects, the Engine will send the <code>change</code> property with the handles for any object that has gone from valid to invalid. At that point, it is up to us to validate the objects again or not.</br></br></p><p>For example, assume we have a model open with:</p><ul><li><p>handle 2 for a field called Country</p></li><li><p>handle 3 and 4 for two valid Generic Objects</p></li></ul></div><div class="col-xs-0 col-sm-0 col-md-0 col-lg-0 body-right"><div class="graph"></div></div></div></div><div id="section-5"class="section select-request"><div class="row">
              <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6 body-left">
        <p>We can apply a selection in our field like so:</p></div><div class="col-xs-6 col-sm-6 col-md-6 col-lg-6 body-right"><div class="graph" id="select-request"></div></div></div></div><div id="section-6"class="section select-response"><div class="row">
              <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6 body-left">
        <p>Because this call will change the data model state, our two Generic Objects will become invalidated. The Engine’s response for this call with include the <code>change</code> property with our newly invalidated object handles:</p></div><div class="col-xs-6 col-sm-6 col-md-6 col-lg-6 body-right"><div class="graph" id="select-response"></div></div></div></div><div id="section-7"class="section get-layout"><div class="row">
              <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6 body-left">
        <p>If we want our Generic Objects to stay in sync with this latest model change, we will need to call GetLayout on those handles. Note that if we don’t validate them, we will not get further notifications about them from the QIX Engine. The Engine will only notify us on invalidation; it will not continue to tell us they are invalid as we filter the data model further, unless we validate them again.</br></br></p><p>We could write some JavaScript to listen for these change events. Let’s assume we have a WebSocket open with a QIX Engine stored in the variable <code>conn</code>. We could write:</br></br></p><p>Depending on what you want to do on invalidation, there is a lot more code to be written to keep track of the calls and responses from the Engine and keep Generic Objects in sync. Fortunately for us, Qlik has a library called <code>enigma.js</code> that covers a lot of the boilerplate needed for productive programming with the QIX Engine. We will cover this library in the next chapter.</p></div><div class="col-xs-6 col-sm-6 col-md-6 col-lg-6 body-right"><div class="graph" id="get-layout"></div></div></div></div><div id="section-8"class="section "><div class="row">
              <div class="col-xs-8 col-xs-offset-2 col-sm-8 col-sm-offset-2 col-md-8 col-md-offset-2 col-lg-8 col-lg-offset-2 body-left">
        <h2>Fin</h2><h4>Recap</h4><ul><li><p>Generic Objects have dynamically calculated layouts that we can pull to our browser</p></li><li><p>When our layouts don’t match the state of the data in the Engine, our Generic Objects are said to be “invalidated”</p></li><li><p>In order to stay in sync with the Engine, we need to validate Generic Objects when the underlying data changes with </code>GetLayout</code> calls</p></li></ul></div><div class="col-xs-0 col-sm-0 col-md-0 col-lg-0 body-right"><div class="graph"></div></div></div></div>
      </div>
      <hr/>
    </div>
  </div>
<script type="text/javascript" src="p4.bundle.js"></script><script type="text/javascript" src="app.bundle.js"></script></body>

</html>