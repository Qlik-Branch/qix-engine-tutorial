<div id="section-0"class="section "><div class="row">
          <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6 body-left">
    <p>In Chapter 102, we looked at how Generic Objects can be used to get dynamically calculated data from the QIX Engine. We saw how we can define special properties called <em>dynamic properties</em> on our Generic Objects. These properties are interpretable by the QIX Engine. The QIX Engine can use the dynamic property definitions along with the current state of data to produce a <em>layout</em>.</p><p>The layout is not persisted in the Engine. We only receive the layout when we use the API method GetLayout to calculate and retrieve it for an object. The layout is delivered to us in the browser via our WebSocket connection as discussed in Chapter 103.</p><p>Recall that QIX’s Associative Model is like a state machine. We can filter the data on the fly, or even change properties of existing Generic Objects. All of these operations happen in our QIX Engine. But what if we have a layout in our browser for a Generic Object? While the QIX Engine can update itself, it will not update the data we’ve pulled into our browser. Therefore, if we filter our data model after we’ve pulled a layout for a Generic Object, our Generic Object will be out of sync with the state of data in the Engine. This out of sync behavior of a Generic Object is known as <strong>invalidation</strong>.</p><p><diagram of a QIX Engine state, with a simple generic object calculating something simple like sum of sales. show them out of sync as engine filters?></p></div><div class="col-xs-6 col-sm-6 col-md-6 col-lg-6 body-right"><div class="graph"></div></div></div></div><div id="section-1"class="section "><div class="row">
          <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6 body-left">
    <h2>Invalidation and the Generic Object Lifecycle</h2><p>During a session with the QIX Engine, we can create or get Generic Object instances. These instances have two possible states:</p><ul><li><p>valid – we have a layout for the latest state of the data in the QIX Engine</p></li><li><p>invalid – we do not have a layout for the latest state of data in the QIX Engine</p></li></ul><p>Essentially, the valid/invalid state just tells us whether we are in sync with the QIX Engine or not for any specific object. This is important to know when we are building dashboards for example. If a user filters our dashboard, we want our charts to stay in sync and reflect that filter. Therefore, we need to make sure the Generic Objects for our chart stay valid.</p><p>When objects go from invalid to valid, we refer to the event as <strong>validation</strong>. When objects go from valid to invalid, we refer to the event as <strong>invalidation</strong>.</p><p>Validation of Generic Objects is easy: GetLayout calls validate objects. They return the latest layout based on the current state of data, thus putting our browser-side data back in sync with the Engine.</p><p>Invalidation of Generic Objects can happen several ways, since it just depends on the underlying state of the data model changing somehow. The most common way is by a user filtering the data model. Another common way to invalidate a Generic Object is to modify the properties of the Generic Object. If the properties change, our layout can no longer be valid so the Generic Object will invalidate and require a new layout. Play with validation and invalidation events in the diagram to the right.<interactive diagram of engine + generic object layout; actions for changing the model, see resulting out of sync; actions for getting the layout, thus bringing things back into sync></p></div><div class="col-xs-6 col-sm-6 col-md-6 col-lg-6 body-right"><div class="graph"></div></div></div></div><div id="section-2"class="section "><div class="row">
          <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6 body-left">
    <h2>Listening to the Engine for Invalidation Events</h2><p>If we want to keep our Generic Objects in sync, we need to get their layouts any time that they invalidate. Fortunately for us, the QIX Engine alerts us whenever invalidations happen using a special property on a JSON-RPC message: change.</p><p>The change property is an array of handles. Whenever an event happens in the Engine that invalidates some objects, the Engine will send the change property with the handles for any object that has gone from valid to invalid. At that point, it is up to us to validate the objects again or not.</p><p>For example, assume we have a model open with:</p><ul><li><p>handle 2 for a field called Country</p></li><li><p>handle 3 and 4 for two valid Generic Objects</p></li></ul></div><div class="col-xs-6 col-sm-6 col-md-6 col-lg-6 body-right"><div class="graph"></div></div></div></div><div id="section-3"class="section select-request"><div class="row">
          <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6 body-left">
    <p>We can apply a selection in our field like so:</p></div><div class="col-xs-6 col-sm-6 col-md-6 col-lg-6 body-right"><div class="graph" id="select-request"></div></div></div></div><div id="section-4"class="section select-response"><div class="row">
          <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6 body-left">
    <p>Because this call will change the data model state, our two Generic Objects will become invalidated. The Engine’s response for this call with include the change property with our newly invalidated object handles:</p></div><div class="col-xs-6 col-sm-6 col-md-6 col-lg-6 body-right"><div class="graph" id="select-response"></div></div></div></div><div id="section-5"class="section get-layout"><div class="row">
          <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6 body-left">
    <p>If we want our Generic Objects to stay in sync with this latest model change, we will need to call GetLayout on those handles. Note that if we don’t validate them, we will not get further notifications about them from the QIX Engine. The Engine will only notify us on invalidation; it will not continue to tell us they are invalid as we filter the data model further, unless we validate them again.</p><p>We could write some JavaScript to listen for these change events. Let’s assume we have a WebSocket open with a QIX Engine stored in the variable conn. We could write:</p><p>Depending on what you want to do on invalidation, there is a lot more code to be written to keep track of the calls and responses from the Engine and keep Generic Objects in sync. Fortunately for us, Qlik has a library called engima.js that covers a lot of the boilerplate needed for productive programming with the QIX Engine. We will cover this library in the next chapter.</p></div><div class="col-xs-6 col-sm-6 col-md-6 col-lg-6 body-right"><div class="graph" id="get-layout"></div></div></div></div><div id="section-6"class="section "><div class="row">
          <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6 body-left">
    <h2>Fin</h2><h4>Recap</h4><ul><li><p>Generic Objects have dynamically calculated layouts that we can pull to our browser</p></li><li><p>When our layouts don’t match the state of the data in the Engine, our Generic Objects are said to be “invalidated”</p></li><li><p>In order to stay in sync with the Engine, we need to validate Generic Objects when the underlying data changes with GetLayout calls</p></li></ul><h4>Resources</h4><ul><li></li></ul><h4>Troubleshooting Guide</h4><ul><li></li></ul></div><div class="col-xs-6 col-sm-6 col-md-6 col-lg-6 body-right"><div class="graph"></div></div></div></div>