<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Streamline with Enigma</title>
    <link href="bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="app.css" rel="stylesheet"></head>
  <body>
    <script src="jquery.min.js"></script>
    <script src="bootstrap/dist/js/bootstrap.min.js"></script>

    <div id="sidebar" class="sidebar">
  <div class="sidebar-label">QIX Tutorial</div>
  <div><a href="javascript:void(0)" class="closebtn">&times;</a></div>
  <hr/>
  <ul class="nav nav-sidebar">
    <li class="chapter-1"><a href="101. What is QIX and Why Should You Care.html"><span class="glyphicon glyphicon-menu-right"></span> 101. What is QIX and why should you care</a>
      <ul class="nav sub-sidebar sublist-0">
        <li><a href="#h2-0">The QIX engine</a></li>
        <li><a href="#h2-1">The associative model: overview</a></li>
        <li><a href="#h2-2">The associative model: breakdown</a></li>
        <li><a href="#h2-3">Leveraging the associative model</a></li>
        <li><a href="#h2-4">Fin</a></li>
      </ul>
    </li>
    <li class="chapter-2"><a href="102. Meet the Engine.html"><span class="glyphicon glyphicon-menu-right"></span> 102. Meet the engine</a>
      <ul class="nav sub-sidebar sublist-1">
        <li><a href="#h2-0">Structure of the associative model</a></li>
        <li><a href="#h2-1">Classes and their methods</a></li>
        <li><a href="#h2-2">Working with generic objects</a></li>
        <li><a href="#h2-3">Fin</a></li>
      </ul>
    </li>
    <li class="chapter-3"><a href="103. Talk to the Engine.html"><span class="glyphicon glyphicon-menu-right"></span> 103. Talk to the Engine</a>
      <ul class="nav sub-sidebar sublist-2">
        <li><a href="#h2-0">Establishing a session with the engine</a></li>
        <li><a href="#h2-1">Speaking the engine's language with handles</a></li>
        <li><a href="#h2-2">Fin</a></li>
      </ul>
    </li>
    <li class="chapter-4"><a href="104. Stay in Sync with the Engine.html"><span class="glyphicon glyphicon-menu-right"></span> 104. Stay in Sync with the Engine</a>
      <ul class="nav sub-sidebar sublist-2">
        <li><a href="#h2-0">Invalidation and the generic object lifecycle</a></li>
        <li><a href="#h2-1">Listening to the engine for invalidation events</a></li>
        <li><a href="#h2-2">Fin</a></li>
      </ul>
    </li>
    <li class="chapter-5"><a href="105. Streamline with Enigma.html"><span class="glyphicon glyphicon-menu-right"></span> 105. Streamline with Enigma</a>
      <ul class="nav sub-sidebar sublist-2">
        <li><a href="#h2-0">Meet enigma</a></li>
        <li><a href="#h2-1">Configuring enigma for an engine</a></li>
        <li><a href="#h2-2">Handling invalidation in enigma</a></li>
        <li><a href="#h2-3">Fin</a></li>
      </ul>
    </li>
    </li>
    <li class="chapter-6"><a href="106. Build a Dashboard - Set Up.html"><span class="glyphicon glyphicon-menu-right"></span> 106. Build a Dashboard - Set Up</a>
      <ul class="nav sub-sidebar sublist-2">
        <li><a href="#h2-0">Project goal and overview</a></li>
        <li><a href="#h2-1">Setting up the project</a></li>
        <li><a href="#h2-2">Connecting to a server</a></li>
        <li><a href="#h2-3">Opening a model</a></li>
        <li><a href="#h2-4">Fin</a></li>
      </ul>
    </li>
    <li class="chapter-7"><a href="107. Creating Filters with ListObjects.html"><span class="glyphicon glyphicon-menu-right"></span> 107. Creating Filters with ListObjects</a>
      <ul class="nav sub-sidebar sublist-2">
        <li><a href="#h2-0">Defining list objects</a></li>
        <li><a href="#h2-1">Setting up data fetching</a></li>
        <li><a href="#h2-2">Getting the list object layouts</a></li>
        <li><a href="#h2-3">Rendering a filter with the layout</a></li>
        <li><a href="#h2-4">Making selections with the filter</a></li>
      </ul>
    </li>
    <li class="chapter-8"><a href="108. Creating Charts with HyperCubes.html"><span class="glyphicon glyphicon-menu-right"></span> 108. Creating Charts with HyperCubes</a>
      <ul class="nav sub-sidebar sublist-2">
        <li><a href="#h2-0">What are hypercubes?</a></li>
        <li><a href="#h2-1">Defining a hypercube</a></li>
        <li><a href="#h2-2">Parsing a hypercube layout</a></li>
        <li><a href="#h2-3">Sorting the hypercube</a></li>
        <li><a href="#h2-4">Visualizing the hypercube</a></li>
        <li><a href="#h2-5">Fin</a></li>
      </ul>
    </li>
  </ul>
</div>

 <div class="hamburger-open">&#9776;</div> 

    <div class="main-content">
      <div class="container content">
        <div class="header">
          <h1>105. Streamline with Enigma</h1><p>Learning goal: Understand how Enigma can be used to work with the QIX Engine API</p>
          <hr/>
        </div>
        <div id="body-content">
          <div id="section-0"class="section "><div class="row">
              <div class="col-xs-8 col-xs-offset-2 col-sm-8 col-sm-offset-2 col-md-8 col-md-offset-2 col-lg-8 col-lg-offset-2 body-left">
        <h2>Meet Enigma</h2><p>In the previous chapters, we’ve reviewed how the Engine API works at a low level using JSON-RPC messages sent across a WebSocket between a browser and an Engine. Writing and parsing these messages, especially in an asynchronous manner, can be very tedious in JavaScript. Qlik’s Enigma library solves this problem by abstracting the Engine API to a slightly higher level. Enigma is an <a href="https://github.com/qlik-oss/enigma.js">open-source library hosted on GitHub</a>.</br></br></p><h3>A Promise Wrapper</h3><p>Enigma’s approach to the Engine API is to wrap all of the API methods with <em>Promises</em>.  Promises are a way of dealing with asynchronous code. Like their name implies, they execute some function that <em>promises</em> that it will return a value at some point in the future, or error. Promises have useful features such as chaining and error handling that make them much better for asynchronous programming than nested callback functions that developers used to rely on. Promises are now natively supported in JavaScript. <a href="https://developers.google.com/web/fundamentals/getting-started/primers/promises">To learn more about Promises and how to use them, we recommend this introduction.</a></p></div><div class="col-xs-0 col-sm-0 col-md-0 col-lg-0 body-right"><div class="graph"></div></div></div></div><div id="section-1"class="section enigma-create-session"><div class="row">
              <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6 body-left">
        <p>With Enigma, we don’t have to create our own WebSocket connection, write out the individual JSON-RPC messages, or create listeners for the responses. It will handle all of that logic for us, providing an easy Promise interface on top of it. For example, check out the code to the right for connecting to an Engine.</br></br></p><p>We pass Enigma a <code>config</code> object that will tell it what Engine to connect to. We will cover this configuration later. This creates a <code>session</code> for us that we can open to start communicating with the Engine.</br></br></p><p>Like all Enigma asynchronous calls, <code>session.open()</code> returns a Promise that will resolve when the session with the Engine has been established. In the example above, once we’ve established the session, the Promise provides us with an object. This object represents our instance of Global class in the session with a handle of <code>-1</code>.</p></div><div class="col-xs-6 col-sm-6 col-md-6 col-lg-6 body-right"><div class="graph" id="enigma-create-session"></div></div></div></div><div id="section-2"class="section session-open"><div class="row">
              <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6 body-left">
        <h3>Handles in Enigma</h3><p>By using the <code>session.open()</code> call above, we were able to connect to an Engine and access an instance of the Global class. Now that we have this instance, we can use it to execute API calls. Recall that we had methods on our Global class like <code>EngineVersion</code> and <code>OpenDoc</code>. In Enigma, these methods are available directly on objects. These methods will make an API call and return a Promise to us for the result. They are written in camelCase instead of PascalCase, so a call like <code>EngineVersion</code> is written as <code>engineVersion</code>. For example, I can rewrite the code above to get the Engine version.</br></br></p><p>Contrast this code with what we wrote without Enigma in Chapter 103. This is much easier, scalable, and maintainable than writing calls from scratch.</p></div><div class="col-xs-6 col-sm-6 col-md-6 col-lg-6 body-right"><div class="graph" id="session-open"></div></div></div></div><div id="section-3"class="section get-cardinal"><div class="row">
              <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6 body-left">
        <p>For any API call that we make that returns a class instance with a handle, Enigma will give us an interface for that instance with the appropriate API methods. That way, we can get apps, fields, and generic objects and easily make API calls with them as well. Let’s demonstrate using an example from a previous chapter. Let’s connect to an Engine, open a model, get a field, and then get the number of distinct values for that field. In Enigma, we could write this like in the adjacent code block.</p></div><div class="col-xs-6 col-sm-6 col-md-6 col-lg-6 body-right"><div class="graph" id="get-cardinal"></div></div></div></div><div id="section-4"class="section "><div class="row">
              <div class="col-xs-8 col-xs-offset-2 col-sm-8 col-sm-offset-2 col-md-8 col-md-offset-2 col-lg-8 col-lg-offset-2 body-left">
        <h2>Configuring Enigma for an Engine</h2><p>Enigma will set up the WebSocket session for us, so we need to pass it an object that gives it a configuration for our Engine. Enigma is also agnostic to any version of the Engine. Therefore, we also need to pass it an API schema for the version of the Engine that we are using so that it can work properly. These schemas are provided with the Enigma library – we just need to provide the appropriate one.</br></br></p><p><a href="https://github.com/qlik-oss/enigma.js/blob/master/docs/api.md#configuration">The configuration is documented on GitHub.</a> Let’s walk through a very simple configuration example.</p></div><div class="col-xs-0 col-sm-0 col-md-0 col-lg-0 body-right"><div class="graph"></div></div></div></div><div id="section-5"class="section engine-config"><div class="row">
              <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6 body-left">
        <p>Assume I want to connect to an Engine on the server <code>localhost</code>. The port for the server is <code>9076</code>, and I want to open a model called “MyModel”.  The Engine version that I’m connecting to is <code>12.20.0</code>. My server uses SSL. With the documentation outlined on GitHub, I would set up the config like in the adjacent example.</br></br></p><p>This config can passed to <code>enigma.create()</code> to create a <code>session</code> object that can be opened.</br></br></p><p>In the previous chapter, it was mentioned that there are more complex parameters that can be added to a WebSocket URL for connecting to the QIX Engine. Enigma comes with a utility that can take in those parameters via a configuration object and produce the URL for you. <a href="https://github.com/qlik-oss/enigma.js/blob/master/docs/api.md#sense-utilities-api">The details on this approach are available in the Sense utilities API documentation.</a></p></div><div class="col-xs-6 col-sm-6 col-md-6 col-lg-6 body-right"><div class="graph" id="engine-config"></div></div></div></div><div id="section-6"class="section "><div class="row">
              <div class="col-xs-8 col-xs-offset-2 col-sm-8 col-sm-offset-2 col-md-8 col-md-offset-2 col-lg-8 col-lg-offset-2 body-left">
        <h2>Handling Invalidation in Enigma</h2><p>In Chapter 104, we learned about the challenges of staying in sync between our browser and server. We wrote a basic function to monitor change handles from our WebSocket.</p></div><div class="col-xs-0 col-sm-0 col-md-0 col-lg-0 body-right"><div class="graph"></div></div></div></div><div id="section-7"class="section on-change"><div class="row">
              <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6 body-left">
        <p>Enigma makes this process much easier through an event that we can attach callbacks to. In Enigma, every instance has a “changed” event. We can listen and respond to this event, demonstrated in this code snippet.</p></div><div class="col-xs-6 col-sm-6 col-md-6 col-lg-6 body-right"><div class="graph" id="on-change"></div></div></div></div><div id="section-8"class="section get-generic-object"><div class="row">
              <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6 body-left">
        <p>This “changed” event corresponds with invalidations. We could therefore use it to keep a Generic Object validated, for example. Let’s say we used Enigma to get a Generic Object by id like so:</p></div><div class="col-xs-6 col-sm-6 col-md-6 col-lg-6 body-right"><div class="graph" id="get-generic-object"></div></div></div></div><div id="section-9"class="section get-layout"><div class="row">
              <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6 body-left">
        <p>We can augment the last part of our code to monitor for change events and make a <code>getLayout</code> call whenever the Generic Object is invalidated.</p></div><div class="col-xs-6 col-sm-6 col-md-6 col-lg-6 body-right"><div class="graph" id="get-layout"></div></div></div></div><div id="section-10"class="section "><div class="row">
              <div class="col-xs-8 col-xs-offset-2 col-sm-8 col-sm-offset-2 col-md-8 col-md-offset-2 col-lg-8 col-lg-offset-2 body-left">
        <h2>Fin</h2><h4>Recap</h4><ul><li><p>Enigma is an open-source library from Qlik that wraps the Engine API in Promises</p></li><li><p>Enigma returns objects representing instances in our session. Each instance has appropriate API methods available for it’s class</p></li><li><p>Instance invalidation events can be hooked into using the <code>.on(“changed”)</code> event listener</p></li></ul><h4>Resources</h4><ul><li><p><a href="https://github.com/qlik-oss/enigma.js">Enigma</a></p></li><li><p><a href="https://developers.google.com/web/fundamentals/getting-started/primers/promises">Intro to Promises</a></p></li></ul></div><div class="col-xs-0 col-sm-0 col-md-0 col-lg-0 body-right"><div class="graph"></div></div></div></div>
        </div>
        <hr/>
      </div>
    </div>
  <script type="text/javascript" src="p5.bundle.js"></script><script type="text/javascript" src="app.bundle.js"></script></body>
</html>